var addon=new function(){this.init=m;var k;var h;var e;var l;var d;function m(){$(document).on("click",".addon",c).on("click",'a[data-action="cancel-addon"]',j)}function c(q){k=$(this).attr("data-type");var p="type="+k+"&action=prompt&wid="+website_id;var o="/dashboard/post/addon/index.php";form_function.processValues(p,o,i)}function i(p){var o={confirm:false,verify:true};var s=p.find("term").text();var t=p.find("amount_annual").text();var r=p.find("amount").text();var v=p.find("balance").text();var u=p.find("renewal_date").text();var q=s=="year"?"$"+t+"/"+s:"$"+r+"/"+s;loadAlert("Sell Online for only "+q,"Cubender's Shopping Cart is an amazing way to sell your products online. It easily integrates into your current website and allows you to create a beautiful store complete with order management and convenient Stripe Checkout.<Br/><br/>By continuing, you will be billed a pro-rated amount of $"+v+" today. This will cover your current subscription period that ends on "+u+". After this date, you will be charged the regular fee of "+q+'. If you have credits, they will automatically be used towards this transaction. <span class="question">Would you like to continue?</span>',o,b)}function b(o){if(o){var q="type="+k+"&action=process&wid="+website_id;var p="/dashboard/post/addon/index.php";form_function.processValues(q,p,a)}}function a(q){var p={confirm:false,verify:true};var o=q.find("trnApproved").text();var r=q.find("messagetext").text();if(o=="1"){window.open("http://cubender.com/dashboard/"+website_id+"/store","_self")}else{loadAlert("Transaction Declined","We were able to charge the credit card we have on file. The specific message we received was:<br/><b>"+r+'</b> <span class="question">Would you like to update your billing info?</span>',p,g)}}function g(o){if(o){window.open("//cubender.com/account/update/","_self")}}function j(p){var o={confirm:false,verify:true};e=$(this).attr("data-id");l=$(this).attr("data-type");d=$(this).attr("data-website-id");if(l=="cancel"){loadAlert("Cancel this Add-On?",'By continuing, this add-on will not be renewed at your renewal date. All related services and/or content will be disconnected.<span class="question">Would you like to continue?</span>',o,f)}else{confirmAddOn(true)}p.preventDefault();return false}function f(o){if(o){var q="id="+e+"&action="+l+"&wid="+d;var p="/dashboard/post/addon/index.php";form_function.processValues(q,p,n)}}function n(){window.open("//cubender.com/account/update/","_self")}};$(function(){addon.init()});var dashboard=new function(){var m=new Array();this.init=o;function o(){$(document).on("click",".icons .settings",i).on("click",".icons .preview",c).on("click",".action.delete",website.promptDeleteSite).on("click",".action.publish",website.promptPublish).on("click",".icons .design",d).on("click",".icons .transfer",transfer.start).on("click",".action.duplicate",duplicate.start).on("click",".page",j).on("click","form.data .change.vanity",g).on("keyup","form.data input[name=vanity_url]",l);$("#new-site, .new-site").click(e);$(".new-blank-site").click(h);$(".more-website-options").click(function(){var q=$(this).offset();$("#more-website-options").css(q).css("top","+=50").css("left","-=75").show();setTimeout(function(){$(document).click(k)},50)});b()}function k(q){$("#more-website-options").hide();$(document).off("click",k)}function p(q){q.stopPropagation()}function l(q){var r=$(this).val();$("form.data .user-domain .name").text(r)}function g(q){$(this).next().show().focus()}function e(){$(document).trigger("modal",["newsite-window"])}function b(){}function a(q){var r=((q.r*299)+(q.g*587)+(q.b*114))/1000;return r>=128}function h(q){form_function.processValues("","/dashboard/new/",f)}function f(s){var t=s.find("result").text();if(t=="error"){var u=s.find("reason").text();var r={verify:true};loadAlert("You'll need to upgrade first",u+'<span class="question">Would you like to upgrade now?</span>',r,upgrade.confirmUpgrade)}else{var q=s.find("id").text();$.get("/dashboard/scripts/inc.websites.php?id="+q,function(v){if($("#new-site").length){$("#new-site").before(v)}else{$("#list > .thumb-holder > .caption").remove();$("#list .thumb-holder").append(v)}});$("html, body").animate({scrollTop:$(document).height()},1000);$(document).trigger("page-created",[q])}}function j(q){}function d(r){var q=$(this).attr("page_id");window.open("/app/editor/"+q);r.preventDefault();r.stopPropagation();return false}function c(r){var q=$(this).attr("page_id");window.open("/app/preview/"+q)}function i(r){var q=$(this).attr("page_id");window.open("/dashboard/"+q+"/settings/","_self");r.preventDefault();r.stopPropagation();return false}function n(q){}};$(function(){dashboard.init()});var duplicate=new function(){var b;this.init=d;this.start=e;function d(){}function e(f){var g=$(this).attr("page_id");form_function.processValues("duplicate_id="+g,"/dashboard/new/",a);return false}function a(h){var f=h.find("result").text();if(f=="success"){var g={confirm:false,verify:true};b=h.find("id").text();loadAlert("Success!","Your website was duplicated successfully. Would you like to open it now?",g,c)}else{var g={confirm:false,verify:false};loadAlert("Unable to Duplicate","There was a problem duplicating this site. For further help, please contact support@cubender.com.",g)}}function c(f){if(f){window.open("/app/editor/"+b,"_self")}}};$(function(){duplicate.init()});var file_details=new function(){var u;var I;var D;var L;var E;var m;var j=new Array();var l=new Array();var M;var C=new Array();var w=new Array();var s="";var K=false;var H=0;var r=0;var n=0;var v=new Array();var z;var f=new Array();this.open=q;this.init=G;this.newItem=g;this.updateEntry=k;this.findJoinFormFields=d;this.getFormFields=B;this.getJoinFormFields=b;this.toggleEmptyMessage=J;this.closeWindow=p;this.getFieldOptions=A;this.widgetFormFields=j;function G(){$("#details-form").submit(function(N){var O=false;$("#details-form").children().removeClass("error");$("#details-form input.required:text").each(function(){if($(this).val()==""){t($(this).attr("name"),$(this).attr("title"),"required");O=true;return false}else{$(this).removeClass("error")}});if(!O){processForm(N,"/app/files/scripts/update.widgetentry.php",F)}return false});$("#details-window .size-icon").click(function(){$(".details-window").toggleClass("expanded-window");$(this).toggleClass("expand")})}function g(Q,R,O,N,P){q("New Item",O,"",Q,R,N,P,true)}function q(U,O,T,Q,S,N,P,R){H=O;K=R;u=U;I=Q;D=S;L=T;E=N;n=0;$(document).trigger("window-open");showScreenLoader();$.each(P,function(V,W){if(P[V].id==I){C=String(P[V].tab_titles).split(",");w=String(P[V].tab_descriptions).split("|");s=P[V].title;return false}});$.each(E,function(V,W){if(((E[V].id==u)||(!u))&&(E[V].widget_id==I)){u=E[V].id;M=V;return false}});$(document).on("form-fields-done",function(){$(document).off("form-fields-done");i()});$(document).on("form-fields-loaded",function(){$(document).off("form-fields-loaded");o()});$("#details-form-widget-id").val(I);$("#details-form-entry-id").val(u);$("#details-form-path-id").val(H);$("#details-form .hidden").children().remove();$("#details-window .nav").children().remove();$("#details-window .body .window-tab").remove();B(I)}function i(){var P="";var S="";var O="";var U=0;var N="";var R=900;var Q=70;var T="";$.each(C,function(V,W){O+='<li><a href="#tabs-'+V+'">'+W+"</a></li>";T=w[V]!=""&&typeof w[V]!="undefined"?'<span class="info-details"></span>'+w[V]:"";S+='<div id="tabs-'+V+'" class="window-tab"><div class="intro">'+T+"</div></div>"});$("#details-window .item-thumb img").attr("src",L);$("#details-window .title .widget").html(s);$("#details-window .title .id").html(u==false?"":"/ "+u);$("#details-window .nav").append(O);$("#details-window .body").append(S);$.each(C,function(V){N="";$.each(l,function(W,X){if(V==l[W].tab){N+=l[W].data}});$("#details-window .body #tabs-"+V).append(N)});$("#details-window").dialog({width:R,height:"auto",title:"File Details",resizable:false,dialogClass:"details-window",dragStart:popupDragStart,dragStop:popupDragStop,open:function(){$(".ui-dialog.details-window").addClass("animate");$(document).trigger("file-details-"+I);form_field.init(j,E,M,I,K);hideScreenLoader()},close:function(V){},beforeClose:function(V,W){$(".ui-dialog.details-window").removeClass("animate");$(".ui-widget-overlay").addClass("fadeOut");setTimeout(function(){$("#details-window").dialog("destroy");$("#details-window .body").tabs("destroy")},500);return false},position:[($(window).width()/2)-((R+Q)/2),70],modal:true})}function F(Q){var U=false;var V;var O;var T;var N;var S;$(Q).find("row").each(function(){O=$(this).find("status").text();T=$(this).find("field").text();N=$(this).find("title").text();S=$(this).find("type").text();V=$(this).find("text").text();if(O=="error"){U=true;return false}});if(!U){p();$(document).one(I+"-"+u,y);$(document).trigger("reload-widget",[I])}else{var R=languageAlerts.errors;var P={confirm:false,verify:false};loadAlert(R.generalTitle,V,P)}}function y(N,O){$.each(j,function(P,Q){if(Q.event!=""){writeOutput('Triggering event "'+Q.event+'" with item value '+O[Q.database_row]);$(document).trigger(Q.event,[O[Q.database_row]])}})}function p(){$("#details-window").dialog("close");writeOutput("Destroying");$(document).trigger("window-close")}function k(O,Q,R,P){var N=0;while(R){O[P][R]=Q.find(R).text();if(Q.children()[N]){R=Q.children()[N].nodeName}else{R=false}N++}}function t(P,Q,O){var R=languageAlerts.errors;var N={confirm:false,verify:false};$("#details-form .form-item").each(function(){if($(this).attr("name")==P){if(O=="required"){loadAlert(R.formErrorRequired,R.formErrorRequiredDescription+Q+".",N)}$(this).addClass("error")}})}function B(O){var N="/app/files/scripts/request.widgetform.php";var P=false;$.each(j,function(Q,R){if(j[Q].widget_id==O){$(document).trigger("form-fields-loaded");P=true;return false}});if(!P){processValues("widget_id="+O,N,a)}}function a(N){handleXmlReturn(N,j);$(document).trigger("form-fields-loaded")}function o(O){var P="";var N;l=[];$.each(j,function(Q,R){j[Q].inited=false;if((j[Q].widget_id==I)||(j[Q].widget_id==O)){l.push({data:form_field.create(j,E,M,K,L,Q),tab:j[Q].tab,widget_id:j[Q].widget_id});r=Q}});$(document).trigger("form-fields-done")}function b(O){var N="/app/files/scripts/request.widget_join.php";showScreenLoader("Loading...","Please wait...");processValues("widget_id="+I+"&child_id="+O+"&entry="+u,N,x,false,O)}function x(N,O){v=[];handleXmlReturn(N,v,h,O)}function h(N){var O=true;$.each(v,function(Q,P){O=false;d(N,Q)});hideScreenLoader();J(O,N)}function d(O,P){var N="";$.each(j,function(R,S){if(j[R].widget_id==O){var U=P!="new"?v[P][j[R].database_row]:"";var T=String(j[R].database_row)+String("[]");var Q=P!="new"?K:true;j[R].pid=I;j[R].inited=false;N+=form_field.create(j,E,M,Q,L,R,U,T)}if(O==j[R].join_id){z=$("#details-window #items-"+j[R].database_row)}});z.append("<div>"+N+"</div>");form_field.init(j,E,M,I,K);J(false,O)}function J(N,O){$.each(j,function(P,Q){if(O==j[P].join_id){z=$("#details-window #items-"+j[P].database_row);if(N){z.append('<span class="empty-message">'+z.attr("empty-message")+"</span>")}else{z.find(".empty-message").remove()}return false}})}function A(P,O){var N="/dashboard/scripts/request.widget_options.php";processValues("widget_id="+P,N,e,false,O)}function e(N,O){f=[];handleXmlReturn(N,f,c,O)}function c(N){var O="";$.each(f,function(P,Q){O+='<option value="'+f[P].id+'">'+f[P].title+"</option>"});$("#"+N).append(O);$(document).trigger("field-options-loaded")}};$(function(){file_details.init()});var form_field=new function(){this.create=b;this.init=e;this.getFieldTitle=c;this.getFieldValue=a;function c(h,j,i){var k=false;$.each(h,function(l,m){if((h[l].database_row==j)&&(h[l].widget_id==i)){k=h[l].type!="Button"?h[l].row_title:false;return false}});return k}function a(h,k,j,i){var l="";$.each(h,function(m,n){if((h[m].database_row==k)&&(h[m].widget_id==j)){l=g(i,h[m].options,h[m].type);return false}});return l}function g(h,j,k){var l=new Array();var i=new Array();switch(j){case"filesize":h=convertsize(h);break;case"date":h=humane_date(h)+'  <span class="gray-text no-margin">('+h+")</span>";break;case"password":h="********";break}switch(k){case"Text":l=j.split(",");$.each(l,function(m,n){i=n.split("=");if(h==i[0]){h=i[1];return false}});break}if(!h){h='<span class="gray-text no-margin">Not available</span>'}return h}function f(h){return $("<div/>").text(h).html()}function b(C,F,Q,O,P,x,y,s){var G="";var v=C[x].add_class!=""?" "+C[x].add_class:"";var E=C[x].row_title;var q=C[x].database_row;var N=O==true?C[x].value:F[Q][q];var H=O==true?"new":F[Q]["id"];var i=C[x].value;var n=C[x].type;var I=C[x].id;var l=C[x].required;var L=C[x].message;var j=C[x].options;var t=C[x].join_id;var o=C[x].info;var u=C[x].link;var r=C[x].value_id;var z=C[x].link_title;var m=C[x].widget_id;var p=l==1?" required":"";var B=C[x].placeholder;var h="";var K=Math.floor((Math.random()*1000)+1);if(s){q=s}if(y){N=y}switch(n){case"editor":G+='<div class="drag-drop-editor"><div><img src="/downloads/248/templates/58462.png" /></div><div contenteditable="true">Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry\'s standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries,</div></div>';break;case"Button":var J=C[x].show_title==1?"":" button-margin";G+='<Button id="button-'+q+'"" type="button" class="advanced light-gray'+J+'" onclick="return false;">'+i+"</Button>";break;case"CheckBox":G+='<div style="float:left; width:50px; height:50px;"><input type="checkbox" name="1" id="1" class="styled"></div>';break;case"Tags":G+='<input id="tags-'+I+'" type="text" placeholder="'+B+'" title="'+E+'" name="'+q+'" class="form-item'+p+'" />';break;case"Photos":G+='<div id="sortable-'+I+'" class="sortable"><ul class="sortable1 connectedSortable left"></ul><div class="drag-to"></div><ul class="sortable2 connectedSortable right"></ul><input type="hidden" class="order" name="'+q+'" value="'+N+'" /></div>';break;case"File":var D=N!=""?"accepted":"";N=N!=""?N:i;G+='<div class="upload-area"><div class="upload-select-button"><input id="'+q+'_upload" name="'+q+'_upload" type="file" multiple="false" style="display:none"></div>Click Here<br/> to Upload</div><div id="'+q+'_filename_container" class="filename_container '+D+'">'+N+'</div><div id="'+q+'_queue_container"></div>';break;case"Members":G+='<div class="field spacer"><div class="header"><label class="header">Member Groups</label></div><div class="tip"><div class="message">To manage your member groups, visit the members section</div></div></div><div class="field"><div class="header"><label class="header">Access Granted To</label></div><div class="tip"><div class="message">Access for this webpage is restricted to the following member groups</div></div></div><div id="sortable-'+I+'" class="sortable"><ul class="sortable1 connectedSortable left"></ul><div class="drag-to"></div><ul class="sortable2 connectedSortable right member"></ul><input type="hidden" class="order" name="'+q+'" value="'+N+'" /></div>';break;case"Remove":G+='<div id="remove-'+I+'" field-id="'+N+'" widget-id="'+m+'" class="remove-button"></div>';break;case"NumericStepper":var w=String(j).split(",");G+='<input id="spinner-'+I+'" type="number" title="'+E+'" value="'+N+'" name="'+q+'" min="'+w[1]+'" max="'+w[2]+'" step="'+w[0]+'" class="form-item'+p+'" />';break;case"Hidden":$(document).one("fieldsLoaded",function(){$("#text_"+K).val(N)});G+='<input id="text_'+K+'" type="hidden" name="'+q+'" />';break;case"Join":G+='<input type="hidden" name="join[]" value="'+t+'" /><div id="items-'+q+'" class="join" empty-message="'+L+'"></div><div class="new-button"><div class="spacer"></div><div class="join-button light-gray large-corner" onclick="file_details.findJoinFormFields('+t+",'new')\">"+i+'</a></div><div class="spacer"></div>';break;case"Image":G+='<div class="image"><div class="background" style="background: url('+P+') 50% 50% no-repeat;"></div></div>';break;case"Text":var k=N==""?i:N;$(document).one("fieldsLoaded",function(){$("#text_"+K).val(N)});k=g(k,j,n);G+='<input id="text_'+K+'" type="hidden" name="'+q+'" /><span class="text">'+k+"</span>";break;case"DateChooser":G+='<input id="date-'+q+'" type="text" title="'+E+'" name="'+q+'" value="'+N+'" class="form-item'+p+'" />';break;case"ComboBox":if(j=="join"){G+='<div class="select"><select id="select-'+q+'" title="'+E+'" name="'+q+'" class="form-item'+p+'"></select></div>'}else{var w=String(j).split(",");var M="";$.each(w,function(S,U){var T=String(w[S]).split("|");if(T.length==2){var R=T[0]==N?" selected":"";M+='<option value="'+T[0]+'"'+R+">"+T[1]+"</option>"}else{var R=w[S]==N?" selected":"";M+='<option value="'+w[S]+'"'+R+">"+w[S]+"</option>"}});G+='<div class="select"><select id="select-'+q+'" title="'+E+'" name="'+q+'" class="form-item'+p+'">'+M+"</select></div>"}break;case"TextInput":$(document).one("fieldsLoaded",function(){$("#text_"+K).val(N)});G+='<input id="text_'+K+'" type="text" placeholder="'+B+'" title="'+E+'" name="'+q+'" class="form-item'+p+'" />';break;case"TextArea":G+='<textarea id="textarea-'+q+'" title="'+E+'" class="form-item" name="'+q+'">'+N+"</textarea>";break;case"Wysiwyg":G+='<textarea id="textarea-'+q+'" title="'+E+'" class="form-item wysiwyg" name="'+q+'">'+N+"</textarea>";G+='<div id="toolbar-'+q+'" style="display: none;" class="wysiwyg-toolbar"><a data-wysihtml5-command="bold" title="CTRL+B" class="no-left-border"><span class="bold">B</span></a><a data-wysihtml5-command="italic" title="CTRL+I"><span class="italic">i</span></a><a data-wysihtml5-command="underline" title="CTRL+U"><span class="underline">U</span></a><a data-wysihtml5-command="insertUnorderedList" title="Insert an unordered list" class="bullets"></a><a data-wysihtml5-action="change_view">&lt;/&gt;</a></div>';break;case"Password":$(document).one("fieldsLoaded",function(){$("#text_"+K).val(N)});G+='<input id="text_'+K+'" type="password" title="'+E+'" name="'+q+'" class="form-item'+p+'" />';break;case"Switch":var A=String(j).split(",");G+='<div class="switch-container"><select id="switch-'+q+'" title="'+E+'" name="'+q+'" class="form-item switch"><option value="'+A[0]+'">'+A[2]+'</option><option value="'+A[1]+'">'+A[3]+"</option></select></div>";break}if(C[x].tip){tip='<div class="tip"><div class="message">'+C[x].tip+"</div></div>"}else{tip=""}if(C[x].show_title==1){requiredStr=l==1?'<span class="gray-text">*</span>':"";u=u!=""?' ( <a href="'+u+'" target="_blank">'+z+"</a> )":"";G='<div class="header"><label class="header">'+E+" "+requiredStr+'<span class="info gray-text">'+o+u+"</span></label></div>"+tip+G}if(n!="Hidden"){G='<div id="item-'+I+'" class="field'+v+'">'+G+"</div>"}return G}function e(i,h,l,k,j){writeOutput("Initializing form fields");$.each(i,function(w,E){var u=j==true?i[w].value:h[l][i[w].database_row];var t=$("#item-"+i[w].id);var o=false;var G=i[w].widget_id;var n=i[w].pid;var y=i[w].inited;var v=i[w].join_id;var q=i[w].options;var z=i[w].value_id;writeOutput("Initializing "+i[w].type);if(((G==k)||(n==k))&&(!y)&&(!t.is(":hiddenByParent"))){switch(i[w].type){case"editor":$(".drag-drop-editor").sortable();break;case"Button":$("#button-"+i[w].database_row).click(function(){var x=new Object();x.type=q;x.id=$("#"+z).val();x.version=false;window_action.action(x)});break;case"CheckBox":Custom.init;break;case"Tags":$("#tags-"+i[w].id).val(u);$("#tags-"+i[w].id).tagsInput();break;case"File":$uploadifiveObj=$("#"+i[w].database_row+"_upload").uploadifive({auto:true,formData:{timestamp:ulTimeStamp,token:ulToken,widget_id:k,row:i[w].database_row},queueID:i[w].database_row+"_queue_container",uploadScript:"/app/files/scripts/upload.file.php?id="+sess_id,onUploadComplete:function(){$("#"+i[w].database_row+"_filename_container").addClass("accepted").html("Your file was uploaded successfully")},removeCompleted:true});break;case"Photos":var p=$("#sortable-"+i[w].id+" .order").val();var s=String(p).split(",");var B="";var H=false;var m=new Array();var D;var F='<div class="empty"><div class="title">No Photos Selected</div><div class="description gray-text">To select photos for this product,<br/>drag items here from the left pane</div></div>';$.each(s,function(I,x){m.push({id:x,data:""})});$(document).one("widget-load-complete",function(){for(var I=0;I<widgetFiles.length;I++){if("9999"==widgetFiles[I].widget_id){D=shortenString(widgetFiles[I].title,30,false);B='<li id="'+widgetFiles[I].id+'" class="ui-state-default"><div class="cart-thumb" image-id="'+widgetFiles[I].id+'" style="background: url(/downloads/'+user_id+"/images/thumb_"+widgetFiles[I].filename+') left 50% no-repeat">'+D+"</div></li>";H=false;$.each(m,function(J,x){if(m[J].id==widgetFiles[I].id){H=true;m[J].data=B}});if(!H){$("#sortable-"+i[w].id+" .sortable1").append(B)}}}B="";$.each(m,function(J,x){B+=m[J].data});$("#sortable-"+i[w].id+" .sortable2").append(B)});if(p==""){$("#sortable-"+i[w].id+" .sortable2").append(F)}files.requestMyFiles("9999","filename","user_images","filename");$("#sortable-"+i[w].id+" .sortable1").sortable({connectWith:".connectedSortable"}).disableSelection();$("#sortable-"+i[w].id+" .sortable2").sortable({connectWith:".connectedSortable",update:function(I,J){var x=$(this).sortable("toArray").toString();if(x[0]==","){x=x.substring(1,x.length)}else{if(x[x.length-1]==","){x=x.substring(0,x.length-1)}}$(this).parent().find(".order").val(x);if(x==""){$(this).append(F)}else{$(this).find(".empty").remove()}}}).disableSelection();break;case"Members":var p=$("#sortable-"+i[w].id+" .order").val();var s=String(p).split(",");var B="";var H=false;var m=new Array();var D;var F='<div class="empty"><div class="title">THIS PAGE IS PUBLIC</div><div class="description gray-text">To restrict access to this webpage to members,<br/>drag member groups here from the left pane</div></div>';H=false;B='<li id="all" class="ui-state-default"><div class="member-thumb" image-id="all">ALL MEMBERS</div></li>';$.each(s,function(I,x){if(x=="all"){H=true;m.push({id:x,data:B})}else{m.push({id:x,data:""})}});if(!H){$("#sortable-"+i[w].id+" .sortable1").append(B)}for(var C=0;C<fileFolderData.length;C++){if("9998"==fileFolderData[C].widget_id){D=shortenString(fileFolderData[C].path,30,false);B='<li id="'+fileFolderData[C].folder_id+'" class="ui-state-default"><div class="member-thumb" image-id="'+fileFolderData[C].folder_id+'">'+D+"</div></li>";H=false;$.each(m,function(I,x){if(m[I].id==fileFolderData[C].folder_id){H=true;m[I].data=B}});if(!H){$("#sortable-"+i[w].id+" .sortable1").append(B)}}}B="";$.each(m,function(I,x){B+=m[I].data});$("#sortable-"+i[w].id+" .sortable2").append(B);if(p==""){$("#sortable-"+i[w].id+" .sortable2").append(F)}$("#sortable-"+i[w].id+" .sortable1").sortable({connectWith:".connectedSortable"}).disableSelection();$("#sortable-"+i[w].id+" .sortable2").sortable({connectWith:".connectedSortable",update:function(I,J){var x=$(this).sortable("toArray").toString();$(this).parent().find(".order").val(x);if(x==""){$(this).append(F)}else{$(this).find(".empty").remove()}}}).disableSelection();break;case"Remove":var A=v;$("#details-window .remove-button").off("click").click(function(){var J=$(this).attr("field-id");var I=$(this).attr("widget-id");if(J!="new"){$("#details-form .hidden").append('<input type="hidden" name="removeArr[]" value="'+I+","+J+'" />')}var x=$(this).parent().parent().fadeOut("fast",function(){var K=$(this).parent();if(K.children().length==1){file_details.toggleEmptyMessage(true,I)}$(this).remove()})});break;case"NumericStepper":break;case"Join":var A=v;$(document).on("form-fields-loaded",function(){$(document).off("form-fields-loaded");file_details.getJoinFormFields(A)});showScreenLoader();file_details.getFormFields(A);break;case"Text":break;case"TextInput":break;case"Wysiwyg":var r=new wysihtml5.Editor("textarea-"+i[w].database_row,{toolbar:"toolbar-"+i[w].database_row,parserRules:wysihtml5ParserRules});break;case"Password":break;case"DateChooser":$("#date-"+i[w].database_row).datepicker({dateFormat:"yy-m-d"});break;case"ComboBox":var A=v;if(q=="join"){$(document).on("field-options-loaded",function(){setSelectbox("select-"+i[w].database_row,u)});file_details.getFieldOptions(v,"select-"+i[w].database_row)}else{setSelectbox("select-"+i[w].database_row,u)}break;case"Switch":setSelectbox("switch-"+i[w].database_row,u);$("#switch-"+i[w].database_row).switchify().data("switch").bind("switch:slide",function(L,J){var K=$(this).parent().find("select").attr("id");var x=$("#"+K+" option:nth-child(1)").val();var M=$("#"+K+" option:nth-child(2)").val();var I="";$("#"+K+" option").attr("selected",false).filter(function(){I=J=="on"?x:M;return $(this).val()==I}).attr("selected",true)});break}i[w].inited=true}});$(document).trigger("fieldsLoaded");$("#details-form .body").tabs();writeOutput("Calling tabs")}function d(i,h){}};var special_form=new function(){var d=new Array();var e;var f;this.init=l;function l(){$(document).on("click","form.data .manage-table .remove",i).on("click","form.data .manage-table .new",h).on("click",".delete-image",j).on("click",".lister .delete",g).on("click",".lister .check-all",k);$(".sortable").sortable();$(".sortable-list").sortable({items:".row.item",axis:"y",update:a})}function k(n){var q=$(this);var o=q.parent();var p=false;var m=0;o=o.closest(".sortable-list");o.find("input:checkbox").not(this).prop("checked",this.checked);if($(this).prop("checked")){$(this).parent().addClass("checked")}else{$(this).parent().removeClass("checked")}}function g(p){var o=false;var m=$(this);var q=m.parents(".sortable-list");d=new Array();e=q.attr("category");$.each(q.find("input:checkbox").not(".check-all"),function(r,s){if($(this).prop("checked")&&$(this).attr("id")!="check-all"){d.push($(this).attr("file-id"));f=q;o=true}});if(o){var n={confirm:false,verify:true};loadAlert("Remove Item(s)",'You are about to permanently remove items. This process cannot be undone. <span class="question">Would you like to continue?</span>',n,c)}p.preventDefault();return false}function c(n){if(n){var m=d.join(",");var p=$(".lister #wid").val();var o=$(".lister #mid").val();form_function.processValues("c="+e+"&d="+m+"&wid="+p+"&mid="+o,"/dashboard/post/remove/",b)}event.preventDefault();return false}function b(){$.each(d,function(m,n){f.find(".row.row-"+n).remove()})}function a(n,p){var o=$(this).sortable("serialize");var m=$(this).attr("category");form_function.processValues(o+"&id="+m,"/dashboard/post/sort/")}function j(m){var n=$(this).attr("item");$(".item"+n).remove();m.preventDefault();return false}function i(m){$(this).closest("tr").remove();return false}function h(m){var n='<tr><td><input type="text" name="optionsName[]" value="" placeholder="Option Name"></td><td><input type="text" name="optionsValue[]" value="" placeholder="Option Values"></td><td><a class="remove">remove</a></td></tr>';$(this).closest(".form-item").find("table.option tbody").append(n);return false}};$(function(){special_form.init()});var themes=new function(){var a=new Array();this.init=e;function e(){}function d(){form_function.processValues("","/dashboard/post/themes/",b)}function b(f){a=new Array();form_function.handleXmlReturn(f,a,c)}function c(){var f='<section id="themes-list"><h1>Select your theme</h1><div class="items">';$.each(a,function(g,h){f+='<div class="thumb" data-id="'+h.id+'"><img src="http://cubender.com/data/3/2/7/screenshots/preview.jpg?cache=1432849337" /><div class="hover-box"></div><a href="">View</a><div class="title">'+h.title+"</div></div>"});f+="</div></section>";$("body").append(f)}};$(function(){themes.init()});var transfer=new function(){this.init=e;this.start=g;function e(){}function g(){var h={confirm:false,verify:true};loadAlert("Transfer Website",'By transferring your site, you will transfer ownership and management access to another user account. The receiving user will be required to authorize this transaction.<span class="question">Would you like to continue?</span>',h,b)}function b(h){if(h){d()}}function d(){var h={confirm:false,verify:true,input:true};loadAlert("Initiate Website Transfer","Please provide the username of the account that will receive this transfer.",h,f)}function f(h){if(h){c(h)}else{d()}}function c(h){form_function.processValues("user="+h+"&website="+website_id,"/dashboard/scripts/transfer.php",a)}function a(j){var h=j.find("result").text();if(h==1){var i={confirm:false,verify:false};loadAlert("Transfer Initiated","The transfer of this website has been initiated. The receiving user must now login and accept the transfer to complete this transaction.",i)}else{var i={confirm:false,verify:false};loadAlert("Unable to Transfer","Sorry but the username you provided either does not exist or is unable to receive this transfer. Please note only a paying subscriber may receive transfers.",i)}}};$(function(){transfer.init()});var upgrade=new function(){this.init=c;this.confirmUpgrade=a;this.goUpgrade=b;function c(){$("#upgrade-now-banner").click(b)}function a(d){if(d){b()}}function b(){window.open("/account/upgrade","_self")}};$(function(){upgrade.init()});var website=new function(){var b;this.init=k;this.promptDeleteSite=h;this.promptPublish=j;function k(){}function h(m){var l={confirm:false,verify:true};b=$(this).attr("page_id");loadAlert("Delete Website",'This will permanently remove the website and all data within. This includes the hosted website, the design and any associated products, images, video or more. This process cannot be undone. <span class="question">Would you like to continue?</span>',l,g);m.preventDefault();return false}function g(l){if(l){loader.show();e()}}function e(){form_function.processValues("id="+b,"/dashboard/delete/",i)}function i(){window.open("/dashboard","_self")}function c(){loadAlert("Transfer Website",'This will permanently remove the website. This process cannot be undone. <span class="question">Please provide the email address...</span>',args,g)}function j(m){var l={confirm:false,verify:true};b=$(this).attr("page_id");loadAlert("Publish",'You are about to publish your website and make it live to the world. <span class="question">Would you like to continue?</span>',l,a)}function a(l){if(l){loader.show();d()}}function d(){form_function.processValues("id="+b,"/app/publish/"+b,f)}function f(m){var n=m.find("result").text();loader.hide();if(n=="success"){}else{var l={confirm:false,verify:false};loadAlert("Wait!","Before you can publish, you need to connect a domain name to your account.",l)}}};var filesWindow=new function(){var d=false;var a;var b;this.init=j;this.isSingleSelection=a;function j(){$(document).on("files",c).on("files-cancel",f).on("files-close",f).on("files-save",f);$("#optionsbar .files").click(function(){if(username!="demo"){$(document).trigger("files",[false,9999,false])}else{var k={confirm:false,verify:false};loadAlert("Demo Mode","You are currently using Cubender in demo mode. File management is disabled.",k)}})}function g(l){var k=l.keyCode||l.which;if(k==13){$(document).trigger("files-save-by-enter-key")}}function c(n,m,o,l){if(username!="demo"){$(document).keypress(g);a=typeof m=="undefined"?false:m;filterWidgetId=typeof o=="undefined"?false:o;b=l===false?false:true;if(!d){$(document).trigger("load-start",["Loading files..."]);$("#files-container").load("/app/editor/files/index.php",i)}else{e();$(document).trigger("files-init",[a,filterWidgetId,b])}}else{var k={confirm:false,verify:false};loadAlert("Demo Mode","You are currently using Cubender in demo mode. File management is disabled.",k)}}function i(){e();d=true;$(document).trigger("load-end").trigger("files-init",[a,filterWidgetId,b])}function e(){$("#files-container").addClass("show");setTimeout(function(){$("#files-container").addClass("animate")},500)}function f(){$("#files-container").removeClass("animate");setTimeout(function(){$("#files-container").removeClass("show");$("#files-container .header").removeClass("show")},1000)}function h(){}};$(function(){filesWindow.init()});